<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Homework Assistant Pro - Academic Success Platform</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- GSAP CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <!-- PDF.js CDN for rendering PDF files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>

    <style>
        body {
            overflow-x: hidden;
            overflow-y: auto;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .professional-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .file-icon {
            position: relative;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 1rem;
            box-shadow: 0 20px 60px rgba(102, 126, 234, 0.3);
        }

        .file-extension {
            position: absolute;
            bottom: 10px;
            right: 10px;
            font-size: 2rem;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.9);
        }

        .sprite {
            position: absolute;
            font-size: 3rem;
            font-weight: bold;
            z-index: 1000;
            pointer-events: none;
        }

        #destructionCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 9999;
            pointer-events: none;
            display: none;
        }

        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 0%, #e0e0e0 50%, #f0f0f0 100%);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

    <!-- Professional Loading Screen -->
    <div id="preLoad" class="fixed inset-0 flex items-center justify-center bg-white z-50">
        <div class="text-center">
            <div class="mb-8">
                <div class="w-20 h-20 mx-auto mb-4 professional-gradient rounded-2xl flex items-center justify-center">
                    <svg class="w-12 h-12 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
            </div>
            <div class="text-2xl font-bold text-gray-800 mb-2">AI Homework Assistant Pro</div>
            <div class="text-sm text-gray-500 mb-6">Initializing AI Analysis Engine...</div>
            <div class="flex justify-center space-x-2">
                <div class="w-2 h-2 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0s;"></div>
                <div class="w-2 h-2 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.1s;"></div>
                <div class="w-2 h-2 bg-indigo-600 rounded-full animate-bounce" style="animation-delay: 0.2s;"></div>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="min-h-screen flex flex-col items-center justify-start p-4 py-8 overflow-y-auto" style="display: none;">
        <!-- Professional Header -->
        <div id="mainHeader" class="w-full max-w-6xl mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 professional-gradient rounded-xl flex items-center justify-center">
                        <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">AI Homework Assistant Pro</h1>
                        <p class="text-sm text-gray-500">Powered by Advanced AI Technology</p>
                    </div>
                </div>
                <div>
                    <span class="badge bg-green-100 text-green-800">‚úì Verified</span>
                </div>
            </div>
        </div>

        <!-- Professional Info Card -->
        <div id="infoCard" class="w-full max-w-4xl mb-8 bg-white rounded-2xl shadow-lg p-8">
            <div class="flex items-start gap-4 mb-6">
                <div class="flex-shrink-0">
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
                <div>
                    <h2 class="text-xl font-bold text-gray-800 mb-2">How It Works</h2>
                    <p class="text-gray-600 leading-relaxed">
                        Upload your homework assignment in any format (PDF, DOCX, images, etc.).
                        Our advanced AI will analyze the content, identify key concepts, and provide
                        comprehensive step-by-step solutions to help you understand the material better.
                    </p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="flex items-center gap-3 p-4 bg-purple-50 rounded-lg">
                    <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-sm font-medium text-gray-700">Instant Analysis</span>
                </div>
                <div class="flex items-center gap-3 p-4 bg-blue-50 rounded-lg">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
                    </svg>
                    <span class="text-sm font-medium text-gray-700">100% Secure</span>
                </div>
                <div class="flex items-center gap-3 p-4 bg-green-50 rounded-lg">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    <span class="text-sm font-medium text-gray-700">AI Powered</span>
                </div>
            </div>

            <!-- File Input -->
            <div id="fileInputSection" class="text-center">
                <label class="cursor-pointer inline-flex items-center gap-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-semibold py-4 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                    </svg>
                    <span class="text-lg">Upload Assignment</span>
                    <input type="file" class="hidden" onchange="fileSelected(event)" accept=".java,.py,.cpp,.js,.zip,.pdf,.docx,.txt,.png,.jpg,.jpeg">
                </label>
                <p class="text-xs text-gray-500 mt-3">Supports PDF, Word, Images, Code files ‚Ä¢ Max 50MB</p>
            </div>
        </div>

        <!-- File Preview Container (Initially Hidden) - Fullscreen -->
        <div id="filePreviewSection" class="fixed inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100 p-8 z-40" style="display: none;">
            <!-- File Name Display -->
            <div id="fileNameDisplay" class="text-lg font-bold text-gray-800 mb-4 text-center">
                assignment.pdf
            </div>

            <!-- File Icon Container - Centered and larger -->
            <div id="fileIconContainer" class="mb-6 flex items-center justify-center" style="max-width: 90vw; max-height: 70vh;">
                <!-- PDF pages will be rendered here or file icon -->
                <div id="pdfPagesContainer" class="flex flex-col items-center gap-4"></div>
                <div id="fileIcon" class="file-icon w-64 h-80 sm:w-80 sm:h-96 flex items-center justify-center">
                    <div class="text-6xl sm:text-8xl">üìÑ</div>
                    <div class="file-extension text-3xl sm:text-4xl">.pdf</div>
                </div>
            </div>

            <!-- Analyse Button -->
            <div class="text-center">
                <button id="analyseBtn"
                        onclick="startDestruction()"
                        class="inline-flex items-center gap-3 bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white font-bold py-5 px-12 rounded-xl text-xl transition-all transform hover:scale-105 shadow-2xl">
                    <svg class="w-7 h-7" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path>
                    </svg>
                    Analyse Assignment
                </button>
            </div>
        </div>
    </div>

    <!-- Destroyer Sprites (Initially Hidden) -->
    <div id="sprite1" class="sprite" style="display: none; top: -100px; left: -100px;">
        üêõ
    </div>

    <div id="sprite2" class="sprite text-yellow-400" style="display: none; top: 50%; right: -300px;">
        <span class="text-2xl font-mono">npm install</span>
    </div>

    <div id="sprite3" class="sprite text-red-600" style="display: none; opacity: 0;">
        <span class="text-4xl font-black" style="font-family: 'Courier New', monospace; letter-spacing: 2px;">
            SEGMENTATION FAULT
        </span>
    </div>

    <!-- Canvas for Particle Explosion -->
    <canvas id="destructionCanvas"></canvas>

    <!-- Success Screen (Initially Hidden) -->
    <div id="finalMessage" class="fixed inset-0 flex items-center justify-center bg-white bg-opacity-95 z-50" style="display: none;">
        <div class="text-center p-8 sm:p-12 bg-white rounded-3xl shadow-2xl max-w-2xl mx-4 border-4 border-green-400">
            <div class="text-8xl mb-6">üéâ</div>
            <div class="text-5xl font-bold text-green-600 mb-4">Problem Solved! üòÅüëç</div>
            <div class="text-2xl text-gray-700 mb-6">
                Your assignment has been eradicated, now go get a life!
            </div>
            <div class="text-lg text-gray-600 mb-8 leading-relaxed">
                Analysis complete. All solutions have been generated.<br>
                <span class="text-sm text-gray-500 italic">Go enjoy your free time!</span>
            </div>
            <button onclick="location.reload()" class="inline-flex items-center gap-2 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 px-8 rounded-xl transition-all transform hover:scale-105 shadow-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Analyse Another Assignment
            </button>
        </div>
    </div>

    <!-- Audio Elements for Sound Effects -->
    <audio id="explosionSound" preload="auto">
        <!-- Using Web Audio API to generate explosion sound -->
    </audio>
    <audio id="successSound" preload="auto">
        <!-- Using Web Audio API to generate success sound -->
    </audio>

    <script>
        // ==========================================
        // AUDIO GENERATION
        // ==========================================

        // Generate explosion sound using Web Audio API
        function playExplosionSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const duration = 1.0;

                console.log('Playing explosion sound!'); // Debug log

                // Create multiple oscillators for LOUD explosion effect
                for (let i = 0; i < 5; i++) {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();

                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);

                    // Lower frequencies for deeper explosion sound
                    oscillator.frequency.setValueAtTime(150 - i * 25, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                    // LOUDER volume
                    gainNode.gain.setValueAtTime(0.6, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);

                    oscillator.start(audioContext.currentTime + i * 0.05);
                    oscillator.stop(audioContext.currentTime + duration);
                }

                // Add noise burst for impact
                const bufferSize = audioContext.sampleRate * 0.5;
                const buffer = audioContext.createBuffer(1, bufferSize, audioContext.sampleRate);
                const data = buffer.getChannelData(0);
                for (let i = 0; i < bufferSize; i++) {
                    data[i] = Math.random() * 2 - 1;
                }

                const noise = audioContext.createBufferSource();
                const noiseGain = audioContext.createGain();
                noise.buffer = buffer;
                noise.connect(noiseGain);
                noiseGain.connect(audioContext.destination);

                noiseGain.gain.setValueAtTime(0.4, audioContext.currentTime);
                noiseGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

                noise.start(audioContext.currentTime);
                noise.stop(audioContext.currentTime + 0.3);
            } catch (error) {
                console.error('Error playing explosion sound:', error);
            }
        }

        // Generate success/congratulations sound - Children saying "Yay!"
        function playSuccessSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            // Create a cheerful "Yay!" sound using multiple oscillators
            // High pitched tones to simulate children's voices
            const frequencies = [800, 950, 1100, 1200, 900, 1000];

            frequencies.forEach((freq, index) => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                const filter = audioContext.createBiquadFilter();

                oscillator.connect(filter);
                filter.connect(gainNode);
                gainNode.connect(audioContext.destination);

                oscillator.frequency.value = freq;
                oscillator.type = 'sine';

                // Add some randomness for more natural sound
                filter.type = 'bandpass';
                filter.frequency.value = freq;
                filter.Q.value = 10;

                const startTime = audioContext.currentTime + index * 0.08;
                const duration = 0.3;

                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(0.4, startTime + 0.02);
                gainNode.gain.exponentialRampToValueAtTime(0.01, startTime + duration);

                oscillator.start(startTime);
                oscillator.stop(startTime + duration);
            });

            // Add a second layer for emphasis
            setTimeout(() => {
                const osc2 = audioContext.createOscillator();
                const gain2 = audioContext.createGain();

                osc2.connect(gain2);
                gain2.connect(audioContext.destination);

                osc2.frequency.value = 1500;
                osc2.type = 'sine';

                gain2.gain.setValueAtTime(0.2, audioContext.currentTime);
                gain2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);

                osc2.start(audioContext.currentTime);
                osc2.stop(audioContext.currentTime + 0.4);
            }, 100);
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================

        // Hide pre-load screen after 2 seconds
        setTimeout(() => {
            gsap.to('#preLoad', {
                opacity: 0,
                duration: 0.5,
                onComplete: () => {
                    document.getElementById('preLoad').style.display = 'none';
                    document.getElementById('mainApp').style.display = 'flex';
                    gsap.from('#mainApp', { opacity: 0, y: 30, duration: 0.8 });
                }
            });
        }, 2000);

        // ==========================================
        // FILE SELECTION
        // ==========================================

        // File selection handler
        async function fileSelected(event) {
            const file = event.target.files[0];
            console.log('File selected:', file);
            if (!file) return;

            // Display actual filename
            document.getElementById('fileNameDisplay').textContent = file.name;

            // Hide everything except file preview
            gsap.to(['#mainHeader', '#infoCard'], {
                opacity: 0,
                duration: 0.5,
                onComplete: async () => {
                    document.getElementById('mainHeader').style.display = 'none';
                    document.getElementById('infoCard').style.display = 'none';

                    // Check if it's a PDF
                    if (file.type === 'application/pdf') {
                        await renderPDF(file);
                    } else {
                        // Show generic file icon (treat as single page)
                        document.getElementById('fileIcon').style.display = 'flex';
                        document.getElementById('pdfPagesContainer').style.display = 'none';
                        // Set to single page for non-PDF files
                        pdfDocument = null;
                        totalPages = 1;
                        currentPageNum = 1;
                    }

                    // Show file preview section (fullscreen)
                    const previewSection = document.getElementById('filePreviewSection');
                    previewSection.style.display = 'flex';

                    // Animate entrance
                    gsap.fromTo('#filePreviewSection',
                        { opacity: 0, scale: 0.9 },
                        { opacity: 1, scale: 1, duration: 0.8 }
                    );
                }
            });
        }

        // Global variables for page-by-page destruction
        let pdfDocument = null;
        let totalPages = 0;
        let currentPageNum = 1;

        // Render PDF - just show the first page
        async function renderPDF(file) {
            const pdfContainer = document.getElementById('pdfPagesContainer');
            pdfContainer.innerHTML = '';
            pdfContainer.style.display = 'flex';
            document.getElementById('fileIcon').style.display = 'none';

            const fileReader = new FileReader();

            fileReader.onload = async function() {
                const typedArray = new Uint8Array(this.result);

                try {
                    pdfDocument = await pdfjsLib.getDocument(typedArray).promise;
                    totalPages = pdfDocument.numPages;
                    currentPageNum = 1;

                    // Render only the first page
                    await renderSinglePage(currentPageNum);

                } catch (error) {
                    console.error('Error rendering PDF:', error);
                    pdfContainer.style.display = 'none';
                    document.getElementById('fileIcon').style.display = 'flex';
                }
            };

            fileReader.readAsArrayBuffer(file);
        }

        // Render a single page
        async function renderSinglePage(pageNum) {
            const pdfContainer = document.getElementById('pdfPagesContainer');
            pdfContainer.innerHTML = ''; // Clear previous page

            try {
                const page = await pdfDocument.getPage(pageNum);

                // Calculate scale to fit the viewport nicely
                const viewport = page.getViewport({ scale: 1.0 });
                const maxHeight = window.innerHeight * 0.6; // 60% of viewport height
                const maxWidth = window.innerWidth * 0.7; // 70% of viewport width

                let scale = Math.min(maxHeight / viewport.height, maxWidth / viewport.width);
                scale = Math.max(scale, 0.5); // Minimum scale
                scale = Math.min(scale, 2.0); // Maximum scale

                const scaledViewport = page.getViewport({ scale: scale });

                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = scaledViewport.height;
                canvas.width = scaledViewport.width;
                canvas.className = 'shadow-2xl rounded-lg border-4 border-indigo-200 bg-white';
                canvas.id = 'currentPageCanvas';

                await page.render({
                    canvasContext: context,
                    viewport: scaledViewport
                }).promise;

                pdfContainer.appendChild(canvas);

                // Add page counter
                const pageInfo = document.createElement('div');
                pageInfo.className = 'text-gray-700 text-center p-3 text-base font-bold bg-white rounded-lg shadow-md mt-4';
                pageInfo.textContent = `Page ${pageNum} of ${totalPages}`;
                pageInfo.id = 'pageInfo';
                pdfContainer.appendChild(pageInfo);

            } catch (error) {
                console.error('Error rendering page:', error);
            }
        }

        // ==========================================
        // DESTRUCTION ANIMATION
        // ==========================================

        let destructionTimeline;

        function startDestruction() {
            // Disable button
            document.getElementById('analyseBtn').disabled = true;
            document.getElementById('analyseBtn').innerHTML = '<span class="animate-pulse">Analysing...</span>';

            // Start destroying pages one by one
            destroyCurrentPage();
        }

        function destroyCurrentPage() {
            // Get file icon position for sprite targeting
            const fileIcon = document.getElementById('fileIconContainer');
            const fileRect = fileIcon.getBoundingClientRect();
            const centerX = fileRect.left + fileRect.width / 2;
            const centerY = fileRect.top + fileRect.height / 2;

            // Reset sprites
            gsap.set(['#sprite1', '#sprite2', '#sprite3'], { clearProps: 'all' });
            document.getElementById('sprite1').style.display = 'block';
            document.getElementById('sprite2').style.display = 'block';
            document.getElementById('sprite3').style.display = 'block';

            // Create GSAP timeline for this page
            destructionTimeline = gsap.timeline();

            // 1. Sprite 1 (Bug) flies in from top-left
            destructionTimeline.fromTo('#sprite1',
                { x: -100, y: -100, rotation: 0 },
                {
                    x: centerX - 50,
                    y: centerY - 50,
                    rotation: 360,
                    duration: 0.8,
                    ease: 'power2.in'
                }
            );

            // 2. File icon shakes violently on impact
            destructionTimeline.to('#fileIconContainer', {
                x: '+=20',
                duration: 0.05,
                yoyo: true,
                repeat: 7,
                ease: 'power1.inOut'
            }, '-=0.1');

            destructionTimeline.to('#fileIconContainer', {
                rotation: '+=15',
                duration: 0.05,
                yoyo: true,
                repeat: 7,
                ease: 'power1.inOut'
            }, '-=0.4');

            // 3. Sprite 2 (npm install) slides in from right (faster)
            destructionTimeline.fromTo('#sprite2',
                { x: window.innerWidth + 300, y: centerY - 100 },
                {
                    x: centerX + 150,
                    duration: 1.5,
                    ease: 'power1.inOut'
                },
                '-=0.2'
            );

            // Brief pause
            destructionTimeline.to({}, { duration: 0.2 });

            // 4. Sprite 3 (Segmentation Fault) appears and drops
            destructionTimeline.set('#sprite3', {
                x: centerX - 200,
                y: centerY - 300,
                opacity: 1
            });

            destructionTimeline.to('#sprite3', {
                y: centerY - 50,
                duration: 0.25,
                ease: 'power4.in'
            });

            // 5. Final trigger - hide everything and start explosion for THIS page
            destructionTimeline.to(['#fileIconContainer', '#sprite1', '#sprite2', '#sprite3'], {
                opacity: 0,
                scale: 0.5,
                duration: 0.15,
                onComplete: () => {
                    // Play explosion sound RIGHT before particle explosion
                    playExplosionSound();
                    startParticleExplosion(centerX, centerY);
                }
            });
        }

        // After particle explosion, check if more pages to destroy
        function afterExplosion() {
            // Hide sprites
            document.getElementById('sprite1').style.display = 'none';
            document.getElementById('sprite2').style.display = 'none';
            document.getElementById('sprite3').style.display = 'none';

            // Reset fileIconContainer transform
            gsap.set('#fileIconContainer', { clearProps: 'all' });

            currentPageNum++;

            // Check if there are more pages
            if (pdfDocument && currentPageNum <= totalPages) {
                // Render next page and destroy it
                setTimeout(async () => {
                    document.getElementById('fileIconContainer').style.opacity = '1';
                    document.getElementById('fileIconContainer').style.scale = '1';
                    await renderSinglePage(currentPageNum);

                    // Animate the new page in
                    gsap.fromTo('#fileIconContainer',
                        { scale: 0, opacity: 0 },
                        {
                            scale: 1,
                            opacity: 1,
                            duration: 0.5,
                            onComplete: () => {
                                // Destroy the new page
                                destroyCurrentPage();
                            }
                        }
                    );
                }, 500);
            } else {
                // All pages destroyed, show final message
                setTimeout(() => {
                    document.getElementById('filePreviewSection').style.display = 'none';
                    showFinalMessage();
                }, 500);
            }
        }

        function showFinalMessage() {
            // Play success sound
            playSuccessSound();

            // Show success message
            document.getElementById('finalMessage').style.display = 'flex';
            gsap.from('#finalMessage > div', {
                scale: 0,
                rotation: 360,
                duration: 1,
                ease: 'back.out'
            });
        }

        // ==========================================
        // PARTICLE SYSTEM
        // ==========================================

        const canvas = document.getElementById('destructionCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const codeChars = ['0', '1', '{', '}', 'NaN', 'NULL', '404', '500', ';', 'üíÄ', 'üî•', 'ERR', 'undefined', 'null'];

        class CodeParticle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 20;
                this.vy = (Math.random() - 0.5) * 20 - 5;
                this.char = codeChars[Math.floor(Math.random() * codeChars.length)];
                this.gravity = 0.3;
                this.opacity = 1;
                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.2;
                this.color = Math.random() > 0.5 ? '#667eea' : '#764ba2';
            }

            update() {
                this.vy += this.gravity;
                this.x += this.vx;
                this.y += this.vy;
                this.rotation += this.rotationSpeed;
                this.opacity -= 0.003;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);
                ctx.globalAlpha = Math.max(0, this.opacity);
                ctx.fillStyle = this.color;
                ctx.font = '20px Courier New';
                ctx.fillText(this.char, 0, 0);
                ctx.restore();
            }
        }

        let particles = [];
        let explosionStartTime;
        let animationFrameId;

        function startParticleExplosion(x, y) {
            canvas.style.display = 'block';

            particles = [];
            for (let i = 0; i < 500; i++) {
                particles.push(new CodeParticle(x, y));
            }

            explosionStartTime = Date.now();
            animateParticles();
        }

        function animateParticles() {
            const elapsed = Date.now() - explosionStartTime;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            particles.forEach(particle => {
                particle.update();
                particle.draw();
            });

            // Shorter explosion time for page-by-page (1.5 seconds instead of 3)
            if (elapsed < 1500) {
                animationFrameId = requestAnimationFrame(animateParticles);
            } else {
                cancelAnimationFrame(animationFrameId);
                canvas.style.display = 'none';

                // Check if there are more pages or show final message
                afterExplosion();
            }
        }

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>
